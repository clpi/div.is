---
- name: Setup server
  host: me.pecu.cc
  collections: 
    - containers.podman
  vars:
    http_port: 80
    max_clients: 200
  remote_user: root
  task:
    - name: Install prereqs for web app
      dnf:
        name:
          - rust
          - nginx
          - nodejs
          - podman
          - neovim
        state: latest
    - name: Copy project files to web app
      copy:
        src: .
        dest: /app
        owner: root
        group: root
    - name: Copy neovim settings
      file:
        path: ~/.config
        state: directory
      copy:
        src: ~/.config/nvim
        dest: ~/.config/nvim
    - name: Clone from git repo
      git:
        repo: https://github.com/pecusys/mem.git
        dest: /src

- name: Install prereqs for data server
  host: md.pecu.cc
  remote_user: root
  task:
    - name: Install Postgres
      dnf:
        name:
          - postgresql
          - postgresql-server
        state: latest
    - name: Start postgres service
      service:
        name: postgresql
        state: started
